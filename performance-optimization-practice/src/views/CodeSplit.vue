<template>
  <div class="container">
    <h1 class="page-title">ä»£ç åˆ†å‰²</h1>
    <p class="page-subtitle">ä¼˜åŒ–æ‰“åŒ…ä½“ç§¯å’ŒåŠ è½½é€Ÿåº¦</p>

    <!-- åŠ¨æ€å¯¼å…¥ -->
    <section class="section card">
      <h2>ğŸ“¦ åŠ¨æ€å¯¼å…¥ (Dynamic Import)</h2>
      <p>ä½¿ç”¨ import() è¯­æ³•å®ç°ä»£ç æŒ‰éœ€åŠ è½½</p>
      
      <div class="dynamic-import-demo">
        <div class="demo-buttons">
          <button @click="loadLodash" class="btn btn-primary" :disabled="lodashLoaded">
            {{ lodashLoaded ? 'Lodash å·²åŠ è½½' : 'åŠ¨æ€åŠ è½½ Lodash' }}
          </button>
          <button @click="loadChartLibrary" class="btn btn-primary" :disabled="chartLoaded">
            {{ chartLoaded ? 'å›¾è¡¨åº“å·²åŠ è½½' : 'åŠ¨æ€åŠ è½½å›¾è¡¨åº“' }}
          </button>
        </div>
        
        <div v-if="lodashResult" class="result-box">
          <h4>Lodash ç¤ºä¾‹ç»“æœï¼š</h4>
          <pre>{{ lodashResult }}</pre>
        </div>
        
        <div v-if="chartLoaded" class="result-box">
          <h4>å›¾è¡¨åº“å·²åŠ è½½ï¼š</h4>
          <p>âœ… å›¾è¡¨ç»„ä»¶å¯ä»¥ä½¿ç”¨äº†</p>
        </div>
      </div>
    </section>

    <!-- æ‰“åŒ…åˆ†æ -->
    <section class="section card">
      <h2>ğŸ“Š æ‰“åŒ…åˆ†æ</h2>
      <p>ä½¿ç”¨ rollup-plugin-visualizer åˆ†ææ‰“åŒ…ç»“æœ</p>
      
      <div class="bundle-analysis">
        <div class="command-box">
          <h4>è¿è¡Œæ‰“åŒ…åˆ†æå‘½ä»¤ï¼š</h4>
          <pre><code>npm run analyze</code></pre>
        </div>
        
        <div class="tips">
          <h4>ğŸ“Œ ä¼˜åŒ–å»ºè®®ï¼š</h4>
          <ul>
            <li>âœ“ ä½¿ç”¨è·¯ç”±æ‡’åŠ è½½ï¼ŒæŒ‰é¡µé¢åˆ†å‰²ä»£ç </li>
            <li>âœ“ ä½¿ç”¨åŠ¨æ€å¯¼å…¥ï¼ŒæŒ‰éœ€åŠ è½½å¤§å‹åº“</li>
            <li>âœ“ é…ç½® manualChunks æ‰‹åŠ¨åˆ†å‰² vendor åŒ…</li>
            <li>âœ“ ä½¿ç”¨ Tree Shaking ç§»é™¤æœªä½¿ç”¨çš„ä»£ç </li>
            <li>âœ“ æ£€æŸ¥é‡å¤æ‰“åŒ…çš„ä¾èµ–</li>
            <li>âœ“ ä½¿ç”¨ CDN åŠ è½½å¤§å‹å…¬å…±åº“</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Chunk åˆ†å‰²ç­–ç•¥ -->
    <section class="section card">
      <h2>âœ‚ï¸ Chunk åˆ†å‰²ç­–ç•¥</h2>
      <p>åˆç†çš„åˆ†åŒ…ç­–ç•¥å¯ä»¥æå‡ç¼“å­˜åˆ©ç”¨ç‡</p>
      
      <div class="chunk-strategy">
        <div class="strategy-item">
          <h4>ğŸ¯ æ¨èåˆ†åŒ…ç­–ç•¥</h4>
          <div class="code-block">
            <pre><code>// vite.config.js
build: {
  rollupOptions: {
    output: {
      manualChunks: {
        // æ¡†æ¶æ ¸å¿ƒ
        'vue-vendor': ['vue', 'vue-router', 'pinia'],
        
        // UI ç»„ä»¶åº“
        'ui-vendor': ['element-plus'],
        
        // å·¥å…·åº“
        'utils': ['lodash-es', 'dayjs', 'axios'],
        
        // å›¾è¡¨åº“
        'charts': ['echarts'],
      }
    }
  }
}</code></pre>
          </div>
        </div>
        
        <div class="strategy-item">
          <h4>ğŸ“ˆ åˆ†åŒ…æ”¶ç›Š</h4>
          <div class="benefits">
            <div class="benefit-card">
              <div class="benefit-icon">ğŸš€</div>
              <h5>é¦–å±åŠ è½½æ›´å¿«</h5>
              <p>åªåŠ è½½å¿…è¦çš„ä»£ç </p>
            </div>
            <div class="benefit-card">
              <div class="benefit-icon">ğŸ’¾</div>
              <h5>ç¼“å­˜æ›´é«˜æ•ˆ</h5>
              <p>vendor åŒ…é•¿æœŸç¼“å­˜</p>
            </div>
            <div class="benefit-card">
              <div class="benefit-icon">ğŸ“¦</div>
              <h5>å¹¶è¡ŒåŠ è½½</h5>
              <p>å¤šä¸ªå°åŒ…å¹¶è¡Œä¸‹è½½</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Tree Shaking -->
    <section class="section card">
      <h2>ğŸŒ³ Tree Shaking</h2>
      <p>è‡ªåŠ¨ç§»é™¤æœªä½¿ç”¨çš„ä»£ç </p>
      
      <div class="tree-shaking-demo">
        <div class="comparison">
          <div class="comparison-item bad">
            <h4>âŒ ä¸å¥½çš„åšæ³•</h4>
            <pre><code>// å¯¼å…¥æ•´ä¸ªåº“
import _ from 'lodash'
const result = _.debounce(fn, 100)

// ä¼šæ‰“åŒ…æ•´ä¸ª lodashï¼ˆ~70KBï¼‰</code></pre>
          </div>
          
          <div class="comparison-item good">
            <h4>âœ… å¥½çš„åšæ³•</h4>
            <pre><code>// æŒ‰éœ€å¯¼å…¥
import { debounce } from 'lodash-es'
const result = debounce(fn, 100)

// åªæ‰“åŒ… debounce å‡½æ•°ï¼ˆ~2KBï¼‰</code></pre>
          </div>
        </div>
        
        <div class="tree-shaking-tips">
          <h4>ğŸ’¡ Tree Shaking æœ€ä½³å®è·µï¼š</h4>
          <ul>
            <li>ä½¿ç”¨ ES6 æ¨¡å—è¯­æ³•ï¼ˆimport/exportï¼‰</li>
            <li>ä½¿ç”¨æ”¯æŒ ES Module çš„åº“ç‰ˆæœ¬ï¼ˆå¦‚ lodash-esï¼‰</li>
            <li>é¿å…å¯¼å…¥æ•´ä¸ªåº“ï¼Œåªå¯¼å…¥éœ€è¦çš„å‡½æ•°</li>
            <li>ç¡®ä¿ package.json ä¸­è®¾ç½® "sideEffects": false</li>
            <li>ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒæ„å»ºï¼ˆè‡ªåŠ¨å¯ç”¨ Tree Shakingï¼‰</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- æ€§èƒ½æŒ‡æ ‡ -->
    <section class="section card">
      <h2>ğŸ“ˆ æ‰“åŒ…æ€§èƒ½æŒ‡æ ‡</h2>
      <div class="performance-metrics">
        <div class="metric-card">
          <div class="metric-value">{{ bundleSize }}</div>
          <div class="metric-label">æ€»åŒ…ä½“ç§¯</div>
        </div>
        <div class="metric-card">
          <div class="metric-value">{{ chunkCount }}</div>
          <div class="metric-label">ä»£ç åˆ†å—æ•°</div>
        </div>
        <div class="metric-card">
          <div class="metric-value">{{ gzipSize }}</div>
          <div class="metric-label">Gzip åå¤§å°</div>
        </div>
      </div>
    </section>
  </div>
</template>

<script setup>
import { ref } from 'vue'

// åŠ¨æ€å¯¼å…¥
const lodashLoaded = ref(false)
const lodashResult = ref('')

const loadLodash = async () => {
  console.log('ğŸ“¦ å¼€å§‹åŠ¨æ€åŠ è½½ Lodash...')
  
  try {
    // åŠ¨æ€å¯¼å…¥ lodash-es
    const { debounce, throttle } = await import('lodash-es')
    
    lodashLoaded.value = true
    lodashResult.value = `æˆåŠŸåŠ è½½ Lodashï¼
å¯ç”¨å‡½æ•°: debounce, throttle
ç¤ºä¾‹: debounce(fn, 300)`
    
    console.log('âœ… Lodash åŠ è½½å®Œæˆ')
  } catch (error) {
    console.error('âŒ Lodash åŠ è½½å¤±è´¥:', error)
    lodashResult.value = 'åŠ è½½å¤±è´¥ï¼Œè¯·ç¡®ä¿å·²å®‰è£… lodash-es'
  }
}

const chartLoaded = ref(false)

const loadChartLibrary = async () => {
  console.log('ğŸ“¦ å¼€å§‹åŠ¨æ€åŠ è½½å›¾è¡¨åº“...')
  
  // æ¨¡æ‹ŸåŠ è½½å›¾è¡¨åº“
  await new Promise(resolve => setTimeout(resolve, 1000))
  
  chartLoaded.value = true
  console.log('âœ… å›¾è¡¨åº“åŠ è½½å®Œæˆ')
}

// æ€§èƒ½æŒ‡æ ‡ï¼ˆç¤ºä¾‹æ•°æ®ï¼‰
const bundleSize = ref('245 KB')
const chunkCount = ref('8')
const gzipSize = ref('85 KB')
</script>

<style lang="scss" scoped>
.section {
  margin-bottom: 2rem;
  
  h2 {
    margin-bottom: 1rem;
    color: #2c3e50;
  }
}

.dynamic-import-demo {
  .demo-buttons {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }
  
  .result-box {
    margin-top: 1rem;
    padding: 1.5rem;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #667eea;
    
    h4 {
      margin: 0 0 0.5rem 0;
      color: #2c3e50;
    }
    
    pre {
      margin: 0;
      padding: 1rem;
      background: white;
      border-radius: 4px;
      overflow-x: auto;
      color: #555;
    }
  }
}

.bundle-analysis {
  .command-box {
    margin-bottom: 1.5rem;
    padding: 1rem;
    background: #2c3e50;
    border-radius: 8px;
    
    h4 {
      margin: 0 0 0.5rem 0;
      color: white;
    }
    
    pre {
      margin: 0;
      
      code {
        color: #4fc08d;
        font-family: 'Courier New', monospace;
      }
    }
  }
  
  .tips {
    padding: 1.5rem;
    background: #f8f9fa;
    border-radius: 8px;
    
    h4 {
      margin: 0 0 1rem 0;
      color: #2c3e50;
    }
    
    ul {
      margin: 0;
      padding-left: 1.5rem;
      
      li {
        margin-bottom: 0.5rem;
        color: #555;
      }
    }
  }
}

.chunk-strategy {
  display: grid;
  gap: 1.5rem;
  
  .strategy-item {
    h4 {
      margin: 0 0 1rem 0;
      color: #2c3e50;
    }
    
    .code-block {
      background: #2c3e50;
      border-radius: 8px;
      padding: 1rem;
      overflow-x: auto;
      
      pre {
        margin: 0;
        
        code {
          color: #a6e22e;
          font-family: 'Courier New', monospace;
          font-size: 0.9rem;
          line-height: 1.6;
        }
      }
    }
    
    .benefits {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      
      .benefit-card {
        text-align: center;
        padding: 1.5rem;
        background: #f8f9fa;
        border-radius: 8px;
        
        .benefit-icon {
          font-size: 2rem;
          margin-bottom: 0.5rem;
        }
        
        h5 {
          margin: 0 0 0.5rem 0;
          color: #2c3e50;
        }
        
        p {
          margin: 0;
          font-size: 0.9rem;
          color: #666;
        }
      }
    }
  }
}

.tree-shaking-demo {
  .comparison {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 1.5rem;
    
    .comparison-item {
      padding: 1rem;
      border-radius: 8px;
      border: 2px solid;
      
      &.bad {
        background: #fff5f5;
        border-color: #fc8181;
        
        h4 {
          color: #c53030;
        }
      }
      
      &.good {
        background: #f0fff4;
        border-color: #68d391;
        
        h4 {
          color: #2f855a;
        }
      }
      
      h4 {
        margin: 0 0 0.5rem 0;
      }
      
      pre {
        margin: 0;
        padding: 1rem;
        background: white;
        border-radius: 4px;
        overflow-x: auto;
        
        code {
          font-family: 'Courier New', monospace;
          font-size: 0.85rem;
          line-height: 1.6;
          color: #2c3e50;
        }
      }
    }
  }
  
  .tree-shaking-tips {
    padding: 1.5rem;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #667eea;
    
    h4 {
      margin: 0 0 1rem 0;
      color: #2c3e50;
    }
    
    ul {
      margin: 0;
      padding-left: 1.5rem;
      
      li {
        margin-bottom: 0.5rem;
        color: #555;
      }
    }
  }
}

.performance-metrics {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
  
  .metric-card {
    text-align: center;
    padding: 2rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 8px;
    color: white;
    
    .metric-value {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }
    
    .metric-label {
      font-size: 1rem;
      opacity: 0.9;
    }
  }
}
</style>

