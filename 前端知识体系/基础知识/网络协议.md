# ğŸŒ Web ç½‘ç»œåè®®

> HTTPã€HTTPSã€WebSocketã€HTTP/2 - å‰ç«¯å¿…çŸ¥çš„ç½‘ç»œçŸ¥è¯†

---

## ğŸ“š ç›®å½•

1. [HTTP åè®®](#http-åè®®)
2. [HTTPS åè®®](#https-åè®®)
3. [HTTP/2 ä¸ HTTP/3](#http2-ä¸-http3)
4. [WebSocket](#websocket)
5. [è·¨åŸŸé—®é¢˜](#è·¨åŸŸé—®é¢˜)

---

## HTTP åè®®

### ğŸ¯ ä»€ä¹ˆæ˜¯ HTTP

**HTTP (HyperText Transfer Protocol)** - è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œæ˜¯ Web çš„åŸºç¡€ã€‚

```
ç‰¹ç‚¹ï¼š
âœ… æ— çŠ¶æ€ - æ¯æ¬¡è¯·æ±‚ç‹¬ç«‹
âœ… æ˜æ–‡ä¼ è¾“ - ä¸åŠ å¯†
âœ… åŸºäºè¯·æ±‚-å“åº”æ¨¡å‹
```

---

### ğŸ“¨ HTTP è¯·æ±‚

```http
GET /api/users HTTP/1.1
Host: api.example.com
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
Authorization: Bearer token123
Cookie: session=abc123
```

**è¯·æ±‚ç»„æˆï¼š**
1. **è¯·æ±‚è¡Œ**ï¼šæ–¹æ³• + URL + åè®®ç‰ˆæœ¬
2. **è¯·æ±‚å¤´**ï¼šå…ƒä¿¡æ¯
3. **è¯·æ±‚ä½“**ï¼šæ•°æ®ï¼ˆGET è¯·æ±‚æ²¡æœ‰ï¼‰

---

### ğŸ¨ HTTP æ–¹æ³•

| æ–¹æ³• | è¯´æ˜ | å¹‚ç­‰æ€§ | å®‰å…¨æ€§ |
|:---:|:---|:---:|:---:|
| **GET** | è·å–èµ„æº | âœ… | âœ… |
| **POST** | åˆ›å»ºèµ„æº | âŒ | âŒ |
| **PUT** | æ›´æ–°èµ„æºï¼ˆå®Œæ•´ï¼‰ | âœ… | âŒ |
| **PATCH** | æ›´æ–°èµ„æºï¼ˆéƒ¨åˆ†ï¼‰ | âŒ | âŒ |
| **DELETE** | åˆ é™¤èµ„æº | âœ… | âŒ |
| **HEAD** | è·å–å¤´ä¿¡æ¯ | âœ… | âœ… |
| **OPTIONS** | è·å–æ”¯æŒçš„æ–¹æ³• | âœ… | âœ… |

---

### ğŸ“Š HTTP çŠ¶æ€ç 

```
1xx ä¿¡æ¯å“åº”
â”œâ”€ 100 Continue
â””â”€ 101 Switching Protocols

2xx æˆåŠŸ
â”œâ”€ 200 OK
â”œâ”€ 201 Created
â”œâ”€ 204 No Content
â””â”€ 206 Partial Content

3xx é‡å®šå‘
â”œâ”€ 301 Moved Permanently      æ°¸ä¹…é‡å®šå‘
â”œâ”€ 302 Found                  ä¸´æ—¶é‡å®šå‘
â”œâ”€ 304 Not Modified           ä½¿ç”¨ç¼“å­˜
â””â”€ 307 Temporary Redirect

4xx å®¢æˆ·ç«¯é”™è¯¯
â”œâ”€ 400 Bad Request            è¯·æ±‚é”™è¯¯
â”œâ”€ 401 Unauthorized           æœªæˆæƒ
â”œâ”€ 403 Forbidden              ç¦æ­¢è®¿é—®
â”œâ”€ 404 Not Found              æœªæ‰¾åˆ°
â””â”€ 429 Too Many Requests      è¯·æ±‚è¿‡å¤š

5xx æœåŠ¡å™¨é”™è¯¯
â”œâ”€ 500 Internal Server Error  æœåŠ¡å™¨é”™è¯¯
â”œâ”€ 502 Bad Gateway            ç½‘å…³é”™è¯¯
â”œâ”€ 503 Service Unavailable    æœåŠ¡ä¸å¯ç”¨
â””â”€ 504 Gateway Timeout        ç½‘å…³è¶…æ—¶
```

---

### ğŸ”‘ å¸¸è§è¯·æ±‚å¤´

```http
# å†…å®¹åå•†
Accept: application/json             # æ¥å—çš„å†…å®¹ç±»å‹
Accept-Encoding: gzip, deflate       # æ¥å—çš„ç¼–ç 
Accept-Language: zh-CN,en            # æ¥å—çš„è¯­è¨€

# ç¼“å­˜æ§åˆ¶
Cache-Control: no-cache              # ç¼“å­˜ç­–ç•¥
If-None-Match: "abc123"              # ETag éªŒè¯
If-Modified-Since: Wed, 21 Oct 2024  # æœ€åä¿®æ”¹æ—¶é—´

# è®¤è¯
Authorization: Bearer token123       # Token è®¤è¯
Cookie: session=abc123               # Cookie

# å…¶ä»–
User-Agent: Mozilla/5.0              # æµè§ˆå™¨ä¿¡æ¯
Referer: https://example.com         # æ¥æºé¡µé¢
Origin: https://example.com          # è·¨åŸŸæ ‡è¯†
```

---

### ğŸ“¦ å¸¸è§å“åº”å¤´

```http
# å†…å®¹ä¿¡æ¯
Content-Type: application/json       # å†…å®¹ç±»å‹
Content-Length: 1234                 # å†…å®¹é•¿åº¦
Content-Encoding: gzip               # å†…å®¹ç¼–ç 

# ç¼“å­˜æ§åˆ¶
Cache-Control: max-age=3600          # ç¼“å­˜ç­–ç•¥
ETag: "abc123"                       # èµ„æºæ ‡è¯†
Last-Modified: Wed, 21 Oct 2024      # æœ€åä¿®æ”¹æ—¶é—´

# è·¨åŸŸ
Access-Control-Allow-Origin: *       # å…è®¸çš„æº
Access-Control-Allow-Methods: GET, POST  # å…è®¸çš„æ–¹æ³•

# å…¶ä»–
Set-Cookie: session=abc123; HttpOnly # è®¾ç½® Cookie
Location: https://new-url.com        # é‡å®šå‘åœ°å€
```

---

## HTTPS åè®®

### ğŸ”’ ä»€ä¹ˆæ˜¯ HTTPS

**HTTPS = HTTP + SSL/TLS**ï¼Œåœ¨ HTTP åŸºç¡€ä¸ŠåŠ å¯†ä¼ è¾“ã€‚

```
HTTPï¼š
å®¢æˆ·ç«¯ â†’ æ˜æ–‡æ•°æ® â†’ æœåŠ¡å™¨  âŒ ä¸å®‰å…¨

HTTPSï¼š
å®¢æˆ·ç«¯ â†’ åŠ å¯†æ•°æ® â†’ æœåŠ¡å™¨  âœ… å®‰å…¨
```

---

### ğŸ” åŠ å¯†æ–¹å¼

#### 1. å¯¹ç§°åŠ å¯†

```
åŠ å¯†å’Œè§£å¯†ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥

å®¢æˆ·ç«¯                     æœåŠ¡å™¨
  |---- å¯†é’¥ key ---------->|
  |---- åŠ å¯†æ•°æ®(key) ------>|
  |<--- åŠ å¯†å“åº”(key) -------|

ä¼˜ç‚¹ï¼šé€Ÿåº¦å¿«
ç¼ºç‚¹ï¼šå¯†é’¥å¦‚ä½•å®‰å…¨ä¼ è¾“ï¼Ÿ
```

---

#### 2. éå¯¹ç§°åŠ å¯†

```
å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†

å®¢æˆ·ç«¯                         æœåŠ¡å™¨
  |<---- å…¬é’¥(public) ---------|
  |---- åŠ å¯†æ•°æ®(public) ----->|
  |<--- è§£å¯†å¹¶å“åº”(private) ---|

ä¼˜ç‚¹ï¼šå®‰å…¨
ç¼ºç‚¹ï¼šé€Ÿåº¦æ…¢
```

---

#### 3. HTTPS æ··åˆåŠ å¯†

```
1. ä½¿ç”¨éå¯¹ç§°åŠ å¯†ä¼ è¾“å¯¹ç§°å¯†é’¥
2. ä½¿ç”¨å¯¹ç§°åŠ å¯†ä¼ è¾“æ•°æ®

å®¢æˆ·ç«¯                         æœåŠ¡å™¨
  |<---- å…¬é’¥ ----------------|
  |---- å¯¹ç§°å¯†é’¥(ç”¨å…¬é’¥åŠ å¯†) -->|
  |---- æ•°æ®(ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†) -->|
  |<--- å“åº”(ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†) --|

âœ… å®‰å…¨ + å¿«é€Ÿ
```

---

### ğŸ”‘ TLS æ¡æ‰‹æµç¨‹

```
1. Client Hello
   å®¢æˆ·ç«¯å‘é€ï¼šæ”¯æŒçš„åŠ å¯†ç®—æ³•ã€éšæœºæ•°A

2. Server Hello
   æœåŠ¡å™¨å‘é€ï¼šé€‰æ‹©çš„åŠ å¯†ç®—æ³•ã€éšæœºæ•°Bã€è¯ä¹¦

3. å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦
   éªŒè¯è¯ä¹¦æ˜¯å¦æœ‰æ•ˆã€æ˜¯å¦è¢«ä¿¡ä»»çš„ CA ç­¾å‘

4. ç”Ÿæˆé¢„ä¸»å¯†é’¥
   å®¢æˆ·ç«¯ç”Ÿæˆéšæœºæ•°Cï¼Œç”¨å…¬é’¥åŠ å¯†å‘é€ç»™æœåŠ¡å™¨

5. æœåŠ¡å™¨è§£å¯†
   æœåŠ¡å™¨ç”¨ç§é’¥è§£å¯†ï¼Œå¾—åˆ°éšæœºæ•°C

6. ç”Ÿæˆä¼šè¯å¯†é’¥
   åŒæ–¹ç”¨ï¼ˆéšæœºæ•°A + éšæœºæ•°B + éšæœºæ•°Cï¼‰ç”Ÿæˆä¼šè¯å¯†é’¥

7. å¼€å§‹åŠ å¯†é€šä¿¡
   ä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†æ•°æ®
```

---

### ğŸ“œ æ•°å­—è¯ä¹¦

```
è¯ä¹¦åŒ…å«ï¼š
â”œâ”€ åŸŸå
â”œâ”€ å…¬é’¥
â”œâ”€ æœ‰æ•ˆæœŸ
â”œâ”€ ç­¾å‘æœºæ„ï¼ˆCAï¼‰
â””â”€ æ•°å­—ç­¾å

æµè§ˆå™¨éªŒè¯ï¼š
1. è¯ä¹¦æ˜¯å¦è¿‡æœŸ
2. åŸŸåæ˜¯å¦åŒ¹é…
3. æ˜¯å¦è¢«ä¿¡ä»»çš„ CA ç­¾å‘
4. è¯ä¹¦æ˜¯å¦è¢«åŠé”€
```

---

## HTTP/2 ä¸ HTTP/3

### ğŸš€ HTTP/2 ç‰¹æ€§

#### 1. å¤šè·¯å¤ç”¨

```
HTTP/1.1ï¼šä¸€ä¸ªè¿æ¥ä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚
TCPè¿æ¥1: [è¯·æ±‚1] â†’ [ç­‰å¾…] â†’ [è¯·æ±‚2]

HTTP/2ï¼šä¸€ä¸ªè¿æ¥å¯ä»¥å¹¶å‘å¤„ç†å¤šä¸ªè¯·æ±‚
TCPè¿æ¥1: [è¯·æ±‚1][è¯·æ±‚2][è¯·æ±‚3]  â† åŒæ—¶è¿›è¡Œ
```

---

#### 2. å¤´éƒ¨å‹ç¼©

```
HTTP/1.1ï¼šæ¯æ¬¡è¯·æ±‚éƒ½è¦å‘é€å®Œæ•´çš„å¤´éƒ¨
è¯·æ±‚1: User-Agent: Mozilla/5.0...
è¯·æ±‚2: User-Agent: Mozilla/5.0...  â† é‡å¤

HTTP/2ï¼šä½¿ç”¨ HPACK å‹ç¼©ï¼Œç›¸åŒå¤´éƒ¨åªå‘ä¸€æ¬¡
è¯·æ±‚1: User-Agent: Mozilla/5.0...
è¯·æ±‚2: [ç´¢å¼•]  â† åªå‘é€ç´¢å¼•
```

---

#### 3. æœåŠ¡å™¨æ¨é€

```
HTML è¯·æ±‚åï¼ŒæœåŠ¡å™¨ä¸»åŠ¨æ¨é€ CSS/JS

å®¢æˆ·ç«¯                        æœåŠ¡å™¨
  |---- GET /index.html ----->|
  |<--- index.html -----------|
  |<--- PUSH: style.css ------|  â† ä¸»åŠ¨æ¨é€
  |<--- PUSH: script.js ------|  â† ä¸»åŠ¨æ¨é€
```

---

### âš¡ HTTP/3 ç‰¹æ€§

**HTTP/3 = HTTP/2 + QUICï¼ˆåŸºäº UDPï¼‰**

```
HTTP/2 é—®é¢˜ï¼š
TCP æœ‰é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼Œä¸€ä¸ªåŒ…ä¸¢å¤±ï¼Œåé¢çš„åŒ…éƒ½è¦ç­‰å¾…

HTTP/3 è§£å†³ï¼š
åŸºäº UDPï¼Œå¤šä¸ªæµç‹¬ç«‹ï¼Œäº’ä¸å½±å“
```

---

## WebSocket

### ğŸ”„ ä»€ä¹ˆæ˜¯ WebSocket

**WebSocket** æ˜¯å…¨åŒå·¥é€šä¿¡åè®®ï¼Œé€‚åˆå®æ—¶é€šä¿¡ã€‚

```
HTTPï¼š
å®¢æˆ·ç«¯ â†’ è¯·æ±‚ â†’ æœåŠ¡å™¨
å®¢æˆ·ç«¯ â† å“åº” â† æœåŠ¡å™¨
ï¼ˆéœ€è¦è½®è¯¢æ‰èƒ½è·å–æ–°æ¶ˆæ¯ï¼‰

WebSocketï¼š
å®¢æˆ·ç«¯ â‡„ æœåŠ¡å™¨
ï¼ˆå»ºç«‹è¿æ¥åï¼ŒåŒå‘å®æ—¶é€šä¿¡ï¼‰
```

---

### ğŸš€ ä½¿ç”¨ WebSocket

```javascript
// åˆ›å»ºè¿æ¥
const ws = new WebSocket('ws://localhost:8080')

// è¿æ¥æˆåŠŸ
ws.onopen = () => {
  console.log('è¿æ¥æˆåŠŸ')
  ws.send('Hello Server!')
}

// æ¥æ”¶æ¶ˆæ¯
ws.onmessage = (event) => {
  console.log('æ”¶åˆ°æ¶ˆæ¯:', event.data)
}

// è¿æ¥é”™è¯¯
ws.onerror = (error) => {
  console.error('è¿æ¥é”™è¯¯:', error)
}

// è¿æ¥å…³é—­
ws.onclose = () => {
  console.log('è¿æ¥å…³é—­')
}

// ä¸»åŠ¨å…³é—­
ws.close()
```

---

### ğŸ¯ åº”ç”¨åœºæ™¯

```
âœ… å³æ—¶èŠå¤©
âœ… å®æ—¶é€šçŸ¥
âœ… ååŒç¼–è¾‘
âœ… åœ¨çº¿æ¸¸æˆ
âœ… è‚¡ç¥¨è¡Œæƒ…
âœ… è§†é¢‘å¼¹å¹•
```

---

### ğŸ”§ å¿ƒè·³æœºåˆ¶

```javascript
class WebSocketClient {
  constructor(url) {
    this.url = url
    this.ws = null
    this.heartbeatTimer = null
    this.reconnectTimer = null
  }
  
  connect() {
    this.ws = new WebSocket(this.url)
    
    this.ws.onopen = () => {
      console.log('è¿æ¥æˆåŠŸ')
      this.startHeartbeat()
    }
    
    this.ws.onmessage = (event) => {
      const data = JSON.parse(event.data)
      if (data.type === 'pong') {
        // æ”¶åˆ°å¿ƒè·³å“åº”
        return
      }
      // å¤„ç†ä¸šåŠ¡æ¶ˆæ¯
      this.handleMessage(data)
    }
    
    this.ws.onclose = () => {
      console.log('è¿æ¥å…³é—­')
      this.stopHeartbeat()
      this.reconnect()
    }
  }
  
  // å¿ƒè·³æ£€æµ‹
  startHeartbeat() {
    this.heartbeatTimer = setInterval(() => {
      if (this.ws.readyState === WebSocket.OPEN) {
        this.ws.send(JSON.stringify({ type: 'ping' }))
      }
    }, 30000)  // 30ç§’ä¸€æ¬¡
  }
  
  stopHeartbeat() {
    if (this.heartbeatTimer) {
      clearInterval(this.heartbeatTimer)
    }
  }
  
  // æ–­çº¿é‡è¿
  reconnect() {
    this.reconnectTimer = setTimeout(() => {
      console.log('å°è¯•é‡è¿...')
      this.connect()
    }, 3000)
  }
  
  send(data) {
    if (this.ws.readyState === WebSocket.OPEN) {
      this.ws.send(JSON.stringify(data))
    }
  }
}

// ä½¿ç”¨
const client = new WebSocketClient('ws://localhost:8080')
client.connect()
```

---

## è·¨åŸŸé—®é¢˜

### ğŸš« ä»€ä¹ˆæ˜¯è·¨åŸŸ

**åŒæºç­–ç•¥**ï¼šåè®®ã€åŸŸåã€ç«¯å£éƒ½ç›¸åŒæ‰ç®—åŒæº

```
å½“å‰é¡µé¢ï¼šhttps://example.com:443

https://example.com:443/api    âœ… åŒæº
https://example.com:8080/api   âŒ ç«¯å£ä¸åŒ
http://example.com/api         âŒ åè®®ä¸åŒ
https://api.example.com/api    âŒ åŸŸåä¸åŒ
```

---

### ğŸ”§ è§£å†³æ–¹æ¡ˆ

#### 1. CORSï¼ˆæ¨èï¼‰

```javascript
// æœåŠ¡å™¨è®¾ç½®å“åº”å¤´
app.use((req, res, next) => {
  res.header('Access-Control-Allow-Origin', '*')
  res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE')
  res.header('Access-Control-Allow-Headers', 'Content-Type, Authorization')
  res.header('Access-Control-Allow-Credentials', 'true')
  next()
})
```

---

#### 2. ä»£ç†ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

```javascript
// vite.config.js
export default {
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '')
      }
    }
  }
}
```

---

#### 3. JSONPï¼ˆè¿‡æ—¶ï¼‰

```javascript
// åªæ”¯æŒ GET è¯·æ±‚
function jsonp(url, callback) {
  const script = document.createElement('script')
  script.src = `${url}?callback=${callback}`
  document.body.appendChild(script)
}

window.handleData = (data) => {
  console.log(data)
}

jsonp('http://api.example.com/data', 'handleData')
```

---

## ğŸ“š å­¦ä¹ èµ„æº

- ğŸ“– [HTTP æƒå¨æŒ‡å—](https://book.douban.com/subject/10746113/)
- ğŸ“– [MDN HTTP æ–‡æ¡£](https://developer.mozilla.org/zh-CN/docs/Web/HTTP)
- ğŸ¬ [å›¾è§£ HTTP](https://www.bilibili.com/video/BV1js411g7Fw)

---

## âœ… å­¦ä¹ æ£€æŸ¥æ¸…å•

- [ ] ç†è§£ HTTP è¯·æ±‚å’Œå“åº”
- [ ] æŒæ¡å¸¸è§çŠ¶æ€ç å«ä¹‰
- [ ] ç†è§£ HTTPS åŠ å¯†åŸç†
- [ ] äº†è§£ HTTP/2 å’Œ HTTP/3
- [ ] ä¼šä½¿ç”¨ WebSocket
- [ ] ç†è§£è·¨åŸŸé—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

---

**ç†è§£ç½‘ç»œåè®®ï¼Œè®©ä½ çš„åº”ç”¨æ›´å®‰å…¨æ›´å¿«ï¼** ğŸŒ

