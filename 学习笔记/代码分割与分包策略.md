# ä»£ç åˆ†å‰²ä¸åˆ†åŒ…ç­–ç•¥

## ğŸ“š ç›®å½•

1. ä»€ä¹ˆæ˜¯ä»£ç åˆ†å‰²
2. ä»£ç åˆ†å‰²çš„ä¸‰ç§æ ¸å¿ƒæ–¹å¼
3. åˆ†åŒ…ç­–ç•¥è¯¦è§£ï¼ˆManual Chunksï¼‰
4. ä¸åŒåˆ†åŒ…é…ç½®çš„æ€§èƒ½å¯¹æ¯”
5. é•¿æœŸç¼“å­˜æœºåˆ¶
6. å¼ºç¼“å­˜ vs åå•†ç¼“å­˜
7. Hash å‘½ååŸç†
8. æœåŠ¡å™¨ç¼“å­˜é…ç½®
9. å®é™…æµ‹è¯•æ–¹æ³•
10. æœ€ä½³å®è·µ
11. å¸¸è§é—®é¢˜

---

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### ä»€ä¹ˆæ˜¯ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰ï¼Ÿ

ä»£ç åˆ†å‰²æ˜¯å°†ä¸€ä¸ªå¤§å‹åº”ç”¨æ‹†åˆ†æˆå¤šä¸ªå°å—ï¼ˆchunksï¼‰ï¼Œè®©æµè§ˆå™¨**æŒ‰éœ€åŠ è½½**ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰ä»£ç ã€‚

**å…³é”®ç‰¹ç‚¹**ï¼š
- ğŸ“¦ å¤§åŒ…æ‹†å°åŒ…ï¼ˆå‡å°‘å•ä¸ªæ–‡ä»¶ä½“ç§¯ï¼‰
- âš¡ æŒ‰éœ€åŠ è½½ï¼ˆç”¨åˆ°æ‰åŠ è½½ï¼‰
- ğŸ”„ å¹¶è¡Œä¸‹è½½ï¼ˆå¤šä¸ªæ–‡ä»¶åŒæ—¶ä¸‹è½½ï¼‰
- ğŸ’¾ åˆ©ç”¨ç¼“å­˜ï¼ˆæ¡†æ¶ä»£ç é•¿æœŸç¼“å­˜ï¼‰

### ä¸ºä»€ä¹ˆéœ€è¦ä»£ç åˆ†å‰²ï¼Ÿ

**é—®é¢˜åœºæ™¯**ï¼š
```
ä¸åˆ†å‰²ï¼š
â”œâ”€ æ‰“åŒ…ï¼šæ‰€æœ‰ä»£ç æ‰“æˆä¸€ä¸ª 245KB çš„æ–‡ä»¶
â”œâ”€ é¦–å±ï¼šå¿…é¡»ä¸‹è½½å…¨éƒ¨ 245KB
â”œâ”€ æ›´æ–°ï¼šæ”¹ä¸€è¡Œä»£ç ï¼Œç”¨æˆ·é‡æ–°ä¸‹è½½ 245KB
â””â”€ ç»“æœï¼šåŠ è½½æ…¢ã€ç¼“å­˜åˆ©ç”¨ç‡ä½ âŒ

ä»£ç åˆ†å‰²ï¼š
â”œâ”€ æ‰“åŒ…ï¼šæ‹†åˆ†æˆå¤šä¸ªå°æ–‡ä»¶
â”‚   â”œâ”€ vue-vendor.js (100KB) - Vue æ¡†æ¶
â”‚   â”œâ”€ lodash.js (70KB) - å·¥å…·åº“
â”‚   â””â”€ index.js (45KB) - ä¸šåŠ¡ä»£ç 
â”œâ”€ é¦–å±ï¼šåªä¸‹è½½å¿…è¦çš„æ–‡ä»¶
â”œâ”€ æ›´æ–°ï¼šåªé‡æ–°ä¸‹è½½æ”¹åŠ¨çš„æ–‡ä»¶
â””â”€ ç»“æœï¼šåŠ è½½å¿«ã€ç¼“å­˜å‘½ä¸­ç‡é«˜ âœ…
```

### ä½œç”¨æ—¶æœº

```
å¼€å‘ç¯å¢ƒ (npm run dev)
â”œâ”€ Vite ä½¿ç”¨ ESM æ¨¡å—
â”œâ”€ æŒ‰éœ€åŠ è½½æºæ–‡ä»¶
â”œâ”€ ä»£ç åˆ†å‰²ä¸æ˜æ˜¾
â””â”€ ä¸»è¦ç”¨äºå¼€å‘è°ƒè¯•

ç”Ÿäº§ç¯å¢ƒ (npm run build)
â”œâ”€ æ‰“åŒ…ç”Ÿæˆåˆ†å‰²åçš„æ–‡ä»¶
â”œâ”€ ç”Ÿæˆ .js æ–‡ä»¶å’Œå¯¹åº” hash
â”œâ”€ ä»£ç åˆ†å‰²å®Œå…¨ç”Ÿæ•ˆ
â””â”€ ç”¨æˆ·ä½“éªŒåˆ°ä¼˜åŒ–æ•ˆæœ
```

---

## ğŸ”§ ä»£ç åˆ†å‰²çš„ä¸‰ç§æ ¸å¿ƒæ–¹å¼

### æ–¹å¼ 1ï¼šè‡ªåŠ¨åˆ†åŒ…ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰

#### é…ç½®ç¤ºä¾‹

```javascript
// vite.config.js - æœ€ç®€é…ç½®
export default {
  build: {
    // ä»€ä¹ˆéƒ½ä¸é…ç½®
  }
}
```

#### æ‰“åŒ…ç»“æœ

```
dist/assets/
â”œâ”€â”€ index-abc123.js           (150KB) â† æ‰€æœ‰ä»£ç æ‰“åœ¨ä¸€èµ·
â”œâ”€â”€ index-abc123.css          (20KB)
```

#### é—®é¢˜åˆ†æ

```
âŒ æ–‡ä»¶å¤ªå¤§ï¼ŒåŠ è½½æ…¢
âŒ æ”¹ä¸€è¡Œä»£ç ï¼Œæ•´ä¸ªæ–‡ä»¶ç¼“å­˜å¤±æ•ˆ
âŒ ä¸èƒ½å¹¶è¡Œä¸‹è½½
âŒ é¦–å±åŠ è½½å†—ä½™ä»£ç 
```

---

### æ–¹å¼ 2ï¼šè·¯ç”±æ‡’åŠ è½½åˆ†åŒ…

#### é…ç½®ç¤ºä¾‹

```javascript
// router/index.js
import { createRouter, createWebHistory } from 'vue-router'

const routes = [
  {
    path: '/',
    name: 'Home',
    // âŒ é™æ€å¯¼å…¥ - ä¼šæ‰“åŒ…åœ¨ä¸€èµ·
    component: Home
  },
  {
    path: '/about',
    name: 'About',
    // âœ… åŠ¨æ€å¯¼å…¥ï¼ˆæ‡’åŠ è½½ï¼‰- å•ç‹¬æ‰“åŒ…
    component: () => import('@/views/About.vue')
  },
  {
    path: '/contact',
    name: 'Contact',
    // âœ… åŠ¨æ€å¯¼å…¥ï¼ˆæ‡’åŠ è½½ï¼‰
    component: () => import('@/views/Contact.vue')
  }
]

const router = createRouter({
  history: createWebHistory(),
  routes
})

export default router
```

#### æ‰“åŒ…ç»“æœ

```
dist/assets/js/
â”œâ”€â”€ index-abc123.js           (80KB)  â† å…¥å£æ–‡ä»¶
â”œâ”€â”€ Home-def456.js            (30KB)  â† é¦–é¡µç»„ä»¶
â”œâ”€â”€ About-ghi789.js           (25KB)  â† About é¡µé¢ï¼ˆæŒ‰éœ€åŠ è½½ï¼‰
â”œâ”€â”€ Contact-jkl012.js         (20KB)  â† Contact é¡µé¢ï¼ˆæŒ‰éœ€åŠ è½½ï¼‰
```

#### æ•ˆæœå¯¹æ¯”

| åœºæ™¯ | é™æ€å¯¼å…¥ | è·¯ç”±æ‡’åŠ è½½ | èŠ‚çœ |
|------|---------|-----------|------|
| **é¦–å±åŠ è½½** | 155KB (å…¨éƒ¨) | 110KB (index + Home) | 45KB (29%) |
| **è®¿é—® About** | å·²åŠ è½½ | å†åŠ è½½ 25KB | - |
| **è®¿é—® Contact** | å·²åŠ è½½ | å†åŠ è½½ 20KB | - |

**ä¼˜åŠ¿**ï¼š
- âœ… é¦–å±åªåŠ è½½å¿…è¦ä»£ç 
- âœ… å…¶ä»–é¡µé¢æŒ‰éœ€åŠ è½½
- âœ… å‡å°‘é¦–å±åŠ è½½æ—¶é—´

---

### æ–¹å¼ 3ï¼šæ‰‹åŠ¨åˆ†åŒ…ï¼ˆManual Chunksï¼‰â­â­â­

è¿™æ˜¯**æœ€é‡è¦çš„ä¼˜åŒ–æ–¹å¼**ï¼

#### åŸºæœ¬é…ç½®

```javascript
// vite.config.js
export default {
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          // æŠŠæŒ‡å®šçš„åº“æ‰“åŒ…æˆç‹¬ç«‹çš„ chunk
          'vue-vendor': ['vue', 'vue-router', 'pinia']
        }
      }
    }
  }
}
```

---

## ğŸ“¦ åˆ†åŒ…ç­–ç•¥è¯¦è§£ï¼ˆ4 ç§ç­–ç•¥å¯¹æ¯”ï¼‰

### ç­–ç•¥ 1ï¼šä¸åˆ†åŒ…ï¼ˆåŸºå‡†å¯¹æ¯”ï¼‰

#### é…ç½®

```javascript
// vite.config.js
export default {
  build: {
    rollupOptions: {
      output: {
        // ä¸é…ç½® manualChunks
      }
    }
  }
}
```

#### æ‰“åŒ…ç»“æœ

```
dist/assets/js/
â””â”€â”€ index-abc123.js           (245KB)
    â”œâ”€â”€ Vue æ¡†æ¶ä»£ç            (80KB)
    â”œâ”€â”€ Vue Router             (20KB)
    â”œâ”€â”€ Lodash                 (70KB)
    â””â”€â”€ ä¸šåŠ¡ä»£ç                (75KB)
```

#### é—®é¢˜

```
âŒ å…¨éƒ¨æ··åœ¨ä¸€èµ·
âŒ æ”¹ä¸šåŠ¡ä»£ç ï¼Œæ•´ä¸ªåŒ…ç¼“å­˜å¤±æ•ˆ
âŒ ä¸èƒ½åˆ©ç”¨æµè§ˆå™¨å¹¶è¡Œä¸‹è½½
âŒ é¦–å±åŠ è½½æ‰€æœ‰ä¾èµ–ï¼ˆåŒ…æ‹¬ä¸éœ€è¦çš„ï¼‰
```

---

### ç­–ç•¥ 2ï¼šåŸºç¡€åˆ†åŒ…ï¼ˆæ¨èå…¥é—¨ï¼‰â­

#### é…ç½®

```javascript
// vite.config.js
export default {
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          // æŠŠ Vue å…¨å®¶æ¡¶å•ç‹¬æ‰“åŒ…
          'vue-vendor': ['vue', 'vue-router', 'pinia']
        },
        chunkFileNames: 'assets/js/[name]-[hash].js',
        entryFileNames: 'assets/js/[name]-[hash].js',
        assetFileNames: 'assets/[ext]/[name]-[hash].[ext]'
      }
    }
  }
}
```

#### æ‰“åŒ…ç»“æœ

```
dist/assets/js/
â”œâ”€â”€ vue-vendor-abc123.js      (100KB)  â† Vue æ¡†æ¶ï¼ˆé•¿æœŸç¼“å­˜ï¼‰
â””â”€â”€ index-def456.js           (145KB)  â† ä¸šåŠ¡ä»£ç  + Lodash
```

#### æ•ˆæœå¯¹æ¯”

| åœºæ™¯ | ä¸åˆ†åŒ… | åŸºç¡€åˆ†åŒ… | ä¼˜åŠ¿ |
|------|--------|----------|------|
| **é¦–æ¬¡è®¿é—®** | ä¸‹è½½ 245KB | ä¸‹è½½ 100KB + 145KB | å¹¶è¡Œä¸‹è½½ |
| **ä¿®æ”¹ä¸šåŠ¡ä»£ç å** | é‡æ–°ä¸‹è½½ 245KB | åªä¸‹è½½ 145KB | **èŠ‚çœ 100KB (41%)** |
| **å¹¶å‘è¯·æ±‚** | 1 ä¸ª | 2 ä¸ª | æ›´å¿« |

#### ä¼˜åŠ¿

```
âœ… Vue æ¡†æ¶ä»£ç ç‹¬ç«‹ï¼Œå¯ä»¥é•¿æœŸç¼“å­˜
âœ… ä¿®æ”¹ä¸šåŠ¡ä»£ç ï¼Œæ¡†æ¶åŒ…ä¸éœ€è¦é‡æ–°ä¸‹è½½
âœ… å¹¶è¡Œä¸‹è½½ 2 ä¸ªæ–‡ä»¶
âœ… é…ç½®ç®€å•ï¼Œé€‚åˆå…¥é—¨
```

---

### ç­–ç•¥ 3ï¼šç»†åˆ†åŒ…ï¼ˆæ¨èä¸­çº§ï¼‰â­â­

#### é…ç½®

```javascript
// vite.config.js
export default {
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          // æ¡†æ¶æ ¸å¿ƒ
          'vue-vendor': ['vue', 'vue-router', 'pinia'],
          
          // å·¥å…·åº“
          'lodash': ['lodash-es'],
          
          // å…¶ä»–ç¬¬ä¸‰æ–¹åº“
          'vendor': ['axios', 'dayjs']
        },
        chunkFileNames: 'assets/js/[name]-[hash].js',
        entryFileNames: 'assets/js/[name]-[hash].js',
        assetFileNames: 'assets/[ext]/[name]-[hash].[ext]'
      }
    }
  }
}
```

#### æ‰“åŒ…ç»“æœ

```
dist/assets/js/
â”œâ”€â”€ vue-vendor-abc123.js      (100KB)  â† Vue æ¡†æ¶
â”œâ”€â”€ lodash-def456.js          (70KB)   â† Lodash
â”œâ”€â”€ vendor-ghi789.js          (15KB)   â† axios + dayjs
â””â”€â”€ index-jkl012.js           (60KB)   â† ä¸šåŠ¡ä»£ç 
```

#### æ•ˆæœå¯¹æ¯”

| åœºæ™¯ | åŸºç¡€åˆ†åŒ… | ç»†åˆ†åŒ… | ä¼˜åŠ¿ |
|------|----------|--------|------|
| **é¦–é¡µä¸ç”¨ Lodash** | ä¸‹è½½ 245KB | ä¸‹è½½ 175KB | **èŠ‚çœ 70KB** |
| **ä¿®æ”¹ä¸šåŠ¡ä»£ç ** | é‡æ–°ä¸‹è½½ 145KB | åªä¸‹è½½ 60KB | **èŠ‚çœ 85KB** |
| **å¹¶å‘è¯·æ±‚** | 2 ä¸ª | 4 ä¸ª | æ›´å¿« |

#### é€‚ç”¨åœºæ™¯

```
âœ… Lodash åªåœ¨æŸäº›é¡µé¢ä½¿ç”¨ï¼ˆæŒ‰éœ€åŠ è½½ï¼‰
âœ… æŸäº›åº“å¾ˆå¤§ä½†ä¸å¸¸æ›´æ–°ï¼ˆé•¿æœŸç¼“å­˜ï¼‰
âœ… æƒ³è¦æ›´ç»†ç²’åº¦çš„ç¼“å­˜æ§åˆ¶
âœ… ä¸­å‹é¡¹ç›®ï¼ˆ500KB - 2MBï¼‰
```

---

### ç­–ç•¥ 4ï¼šé«˜çº§åˆ†åŒ…ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰â­â­â­

#### é…ç½®

```javascript
// vite.config.js
export default {
  build: {
    rollupOptions: {
      output: {
        // ä½¿ç”¨å‡½æ•°åŠ¨æ€åˆ¤æ–­
        manualChunks(id) {
          // 1. node_modules ä¸­çš„åŒ…
          if (id.includes('node_modules')) {
            
            // Vue å…¨å®¶æ¡¶
            if (id.includes('vue') || id.includes('pinia')) {
              return 'vue-vendor'
            }
            
            // UI ç»„ä»¶åº“
            if (id.includes('element-plus') || id.includes('ant-design')) {
              return 'ui-vendor'
            }
            
            // å›¾è¡¨åº“ï¼ˆä½“ç§¯å¤§ï¼Œå•ç‹¬æ‰“åŒ…ï¼‰
            if (id.includes('echarts') || id.includes('chart.js')) {
              return 'charts'
            }
            
            // å·¥å…·åº“
            if (id.includes('lodash') || id.includes('dayjs')) {
              return 'utils'
            }
            
            // å…¶ä»–ç¬¬ä¸‰æ–¹åº“
            return 'vendor'
          }
          
          // 2. ä¸šåŠ¡ä»£ç æŒ‰ç›®å½•åˆ†åŒ…
          if (id.includes('/src/components/')) {
            return 'components'
          }
          
          if (id.includes('/src/utils/')) {
            return 'common'
          }
        },
        chunkFileNames: 'assets/js/[name]-[hash].js',
        entryFileNames: 'assets/js/[name]-[hash].js',
        assetFileNames: 'assets/[ext]/[name]-[hash].[ext]'
      }
    }
  }
}
```

#### æ‰“åŒ…ç»“æœ

```
dist/assets/js/
â”œâ”€â”€ vue-vendor-abc.js         (100KB)  â† Vue æ¡†æ¶
â”œâ”€â”€ ui-vendor-def.js          (200KB)  â† Element Plus
â”œâ”€â”€ charts-ghi.js             (180KB)  â† EChartsï¼ˆæŒ‰éœ€åŠ è½½ï¼‰
â”œâ”€â”€ utils-jkl.js              (80KB)   â† Lodash + dayjs
â”œâ”€â”€ vendor-mno.js             (30KB)   â† axios ç­‰
â”œâ”€â”€ components-pqr.js         (50KB)   â† å…¬å…±ç»„ä»¶
â”œâ”€â”€ common-stu.js             (20KB)   â† å·¥å…·å‡½æ•°
â”œâ”€â”€ Home-vwx.js               (25KB)   â† é¦–é¡µ
â”œâ”€â”€ About-yz1.js              (20KB)   â† About é¡µ
â””â”€â”€ index-234.js              (15KB)   â† å…¥å£
```

#### è¶…å¼ºä¼˜åŠ¿

```
âœ… æœ€ç»†ç²’åº¦çš„ç¼“å­˜æ§åˆ¶
âœ… å¹¶è¡Œä¸‹è½½ 10 ä¸ªæ–‡ä»¶ï¼ˆé€Ÿåº¦å¿«ï¼‰
âœ… ä¿®æ”¹ä¸šåŠ¡ä»£ç ï¼Œåªéœ€é‡æ–°ä¸‹è½½å¾ˆå°çš„æ–‡ä»¶
âœ… å¤§å‹åº“ç‹¬ç«‹æ‰“åŒ…ï¼ŒæŒ‰éœ€åŠ è½½
âœ… æŒ‰åŠŸèƒ½æ¨¡å—åˆ†åŒ…ï¼Œé€»è¾‘æ¸…æ™°
âœ… é€‚åˆå¤§å‹é¡¹ç›®ï¼ˆ> 2MBï¼‰
```

---

## ğŸ“Š å®æˆ˜åœºæ™¯æ€§èƒ½å¯¹æ¯”

### åœºæ™¯ 1ï¼šç”¨æˆ·é¦–æ¬¡è®¿é—®

| ç­–ç•¥ | ä¸‹è½½æ–‡ä»¶ | æ€»å¤§å° | å¹¶è¡Œæ•° | æ—¶é—´ |
|------|---------|--------|--------|------|
| **ä¸åˆ†åŒ…** | 1 ä¸ªå¤§æ–‡ä»¶ | 245KB | 1 | 1.2s |
| **åŸºç¡€åˆ†åŒ…** | vue-vendor + index | 245KB | 2 | 0.9s â¬‡ï¸ |
| **ç»†åˆ†åŒ…** | vue-vendor + index | 160KB | 2 | 0.6s â¬‡ï¸ |
| **é«˜çº§åˆ†åŒ…** | vue + components + Home + index | 190KB | 4 | 0.5s â¬‡ï¸ |

### åœºæ™¯ 2ï¼šä¿®æ”¹ä¸šåŠ¡ä»£ç åï¼Œç”¨æˆ·å†æ¬¡è®¿é—®

| ç­–ç•¥ | éœ€è¦ä¸‹è½½ | å·²ç¼“å­˜ | æ—¶é—´ | èŠ‚çœ |
|------|---------|--------|------|------|
| **ä¸åˆ†åŒ…** | 245KB | 0KB | 1.2s | 0% |
| **åŸºç¡€åˆ†åŒ…** | 145KB | 100KB | 0.7s | **41%** |
| **ç»†åˆ†åŒ…** | 60KB | 185KB | 0.3s | **76%** |
| **é«˜çº§åˆ†åŒ…** | 25KB | 220KB | 0.15s âš¡ | **90%** |

### åœºæ™¯ 3ï¼šåªæ›´æ–° Vue ç‰ˆæœ¬

| ç­–ç•¥ | éœ€è¦ä¸‹è½½ | è¯´æ˜ |
|------|---------|------|
| **ä¸åˆ†åŒ…** | 245KB | å…¨éƒ¨é‡æ–°ä¸‹è½½ |
| **åŸºç¡€åˆ†åŒ…** | 100KB | åªä¸‹è½½ vue-vendor |
| **ç»†åˆ†åŒ…** | 100KB | åªä¸‹è½½ vue-vendor |
| **é«˜çº§åˆ†åŒ…** | 100KB | åªä¸‹è½½ vue-vendor |

---

## ğŸ¯ åˆ†åŒ…ç­–ç•¥é€‰æ‹©æŒ‡å—

### å°å‹é¡¹ç›®ï¼ˆ< 500KBï¼‰

```javascript
// æ¨èï¼šåŸºç¡€åˆ†åŒ…
manualChunks: {
  'vendor': ['vue', 'vue-router']
}
```

**åŸå› **ï¼š
- é¡¹ç›®å°ï¼Œé…ç½®ç®€å•å¤Ÿç”¨
- å‡å°‘é…ç½®å¤æ‚åº¦
- 2-3 ä¸ªåŒ…å³å¯

---

### ä¸­å‹é¡¹ç›®ï¼ˆ500KB - 2MBï¼‰

```javascript
// æ¨èï¼šç»†åˆ†åŒ…
manualChunks: {
  'vue-vendor': ['vue', 'vue-router', 'pinia'],
  'ui-vendor': ['element-plus'],
  'utils': ['lodash-es', 'axios']
}
```

**åŸå› **ï¼š
- ä¾èµ–è¾ƒå¤šï¼Œéœ€è¦ç»†åˆ†
- å¹³è¡¡ç¼“å­˜å’Œè¯·æ±‚æ•°é‡
- 5-8 ä¸ªåŒ…æ¯”è¾ƒåˆé€‚

---

### å¤§å‹é¡¹ç›®ï¼ˆ> 2MBï¼‰

```javascript
// æ¨èï¼šé«˜çº§åˆ†åŒ…ï¼ˆå‡½æ•°é…ç½®ï¼‰
manualChunks(id) {
  if (id.includes('node_modules')) {
    // æŒ‰åº“ç»†åˆ†
    if (id.includes('vue')) return 'vue-vendor'
    if (id.includes('element-plus')) return 'ui-vendor'
    if (id.includes('echarts')) return 'charts'
    return 'vendor'
  }
  
  // æŒ‰åŠŸèƒ½æ¨¡å—åˆ†åŒ…
  if (id.includes('/src/views/dashboard/')) return 'dashboard'
  if (id.includes('/src/views/user/')) return 'user'
}
```

**åŸå› **ï¼š
- ä¾èµ–å¤æ‚ï¼Œéœ€è¦ç²¾ç»†æ§åˆ¶
- æŒ‰åŠŸèƒ½æ¨¡å—åˆ†åŒ…
- 10-20 ä¸ªåŒ…ï¼Œæœ€å¤§åŒ–ç¼“å­˜åˆ©ç”¨ç‡

---

## ğŸ’¾ é•¿æœŸç¼“å­˜æœºåˆ¶

### Hash å‘½ååŸç†

#### æ–‡ä»¶åä¸­çš„ Hash

```javascript
chunkFileNames: 'assets/js/[name]-[hash].js'
```

**ç”Ÿæˆç¤ºä¾‹**ï¼š
```
vue-vendor-DSRHQCgV.js
index-Cy_phKJV.js
Home-abc12345.js
```

#### Hash ç”Ÿæˆè§„åˆ™

```
æ–‡ä»¶å†…å®¹ â†’ MD5/SHA256 ç®—æ³• â†’ ç”Ÿæˆ hash å€¼ â†’ æˆªå–å‰ 8 ä½

ç¤ºä¾‹ï¼š
const content = "import { createApp } from 'vue'..."
const hash = md5(content)  // å®Œæ•´ï¼šDSRHQCgV7j8k2m9n...
const shortHash = hash.slice(0, 8)  // æˆªå–ï¼šDSRHQCgV

æœ€ç»ˆæ–‡ä»¶åï¼švue-vendor-DSRHQCgV.js
```

#### æ ¸å¿ƒè§„åˆ™

```
âœ… å†…å®¹ä¸å˜ â†’ hash ä¸å˜ â†’ æ–‡ä»¶åä¸å˜ â†’ æµè§ˆå™¨ä½¿ç”¨ç¼“å­˜
âœ… å†…å®¹æ”¹å˜ â†’ hash æ”¹å˜ â†’ æ–‡ä»¶åæ”¹å˜ â†’ æµè§ˆå™¨ä¸‹è½½æ–°æ–‡ä»¶
```

---

### é•¿æœŸç¼“å­˜å®Œæ•´æµç¨‹

#### ç¬¬ä¸€æ¬¡éƒ¨ç½²

```
å¼€å‘è€…ï¼š
  æ‰“åŒ…é¡¹ç›® â†’ npm run build
  â†“
ç”Ÿæˆæ–‡ä»¶ï¼š
  vue-vendor-DSRHQCgV.js (100KB)
  index-Cy_phKJV.js (45KB)
  â†“
éƒ¨ç½²åˆ°æœåŠ¡å™¨
  â†“
ç”¨æˆ·è®¿é—®ï¼š
  1. ä¸‹è½½ index.html
  2. HTML ä¸­å¼•ç”¨ï¼š
     <script src="/assets/js/vue-vendor-DSRHQCgV.js"></script>
     <script src="/assets/js/index-Cy_phKJV.js"></script>
  3. æµè§ˆå™¨ä¸‹è½½è¿™ä¸¤ä¸ªæ–‡ä»¶
  4. æœåŠ¡å™¨è¿”å› + ç¼“å­˜å¤´ï¼šCache-Control: max-age=31536000
  5. æµè§ˆå™¨ç¼“å­˜è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼ˆ1 å¹´ï¼‰
```

#### ä¿®æ”¹ä¸šåŠ¡ä»£ç åçš„ç¬¬äºŒæ¬¡éƒ¨ç½²

```
å¼€å‘è€…ï¼š
  ä¿®æ”¹ Home.vue â†’ npm run build
  â†“
ç”Ÿæˆæ–‡ä»¶ï¼š
  vue-vendor-DSRHQCgV.js (100KB)  â† hash ä¸å˜ï¼ˆVue ä»£ç æ²¡å˜ï¼‰
  index-XYZ12345.js (47KB)        â† hash æ”¹å˜ï¼ˆä¸šåŠ¡ä»£ç å˜äº†ï¼‰
  â†“
æ›´æ–° index.htmlï¼š
  <script src="/assets/js/vue-vendor-DSRHQCgV.js"></script>  â† ä¸å˜
  <script src="/assets/js/index-XYZ12345.js"></script>       â† æ”¹å˜
  â†“
ç”¨æˆ·å†æ¬¡è®¿é—®ï¼š
  1. ä¸‹è½½ index.htmlï¼ˆæ£€æµ‹åˆ°å¼•ç”¨çš„æ–‡ä»¶åï¼‰
  2. vue-vendor-DSRHQCgV.jsï¼šæ–‡ä»¶åæ²¡å˜ â†’ ä½¿ç”¨ç¼“å­˜ âœ…
  3. index-XYZ12345.jsï¼šæ–‡ä»¶åå˜äº† â†’ é‡æ–°ä¸‹è½½ âœ…
  â†“
ç»“æœï¼š
  ç”¨æˆ·åªéœ€ä¸‹è½½ 47KB
  èŠ‚çœäº† 100KBï¼ˆvue-vendor ä»ç¼“å­˜è¯»å–ï¼‰
  åŠ è½½é€Ÿåº¦æå‡ 60% ğŸš€
```

---

## ğŸ”„ å¼ºç¼“å­˜ vs åå•†ç¼“å­˜

### ä¸¤ç§ç¼“å­˜æœºåˆ¶å¯¹æ¯”

| å¯¹æ¯”é¡¹ | å¼ºç¼“å­˜ | åå•†ç¼“å­˜ |
|--------|--------|----------|
| **è¯·æ±‚æœåŠ¡å™¨** | âŒ ä¸è¯·æ±‚ | âœ… éœ€è¦è¯·æ±‚ |
| **ç½‘ç»œå¼€é”€** | 0 å­—èŠ‚ | å‡ ç™¾å­—èŠ‚ï¼ˆåªæœ‰å¤´ï¼‰ |
| **å“åº”é€Ÿåº¦** | æå¿«ï¼ˆ0msï¼‰ | å¿«ï¼ˆ~50msï¼‰ |
| **çŠ¶æ€ç ** | `200 (from disk cache)` | `304 Not Modified` |
| **å“åº”å¤´** | `Cache-Control`ã€`Expires` | `ETag`ã€`Last-Modified` |
| **é€‚ç”¨åœºæ™¯** | **å¸¦ hash çš„æ–‡ä»¶** | **ä¸å¸¦ hash çš„æ–‡ä»¶** |

---

### å¼ºç¼“å­˜ï¼ˆStrong Cacheï¼‰

#### å·¥ä½œæµç¨‹

```
ç¬¬ 1 æ¬¡è®¿é—®ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æµè§ˆå™¨  â”‚â”€â”€â”€ GET vue-vendor â”€â”€>â”‚ æœåŠ¡å™¨  â”‚
â”‚         â”‚<â”€â”€ 200 + æ–‡ä»¶ â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚
â”‚         â”‚<â”€â”€ Cache-Control: max-age=31536000, immutable
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
 å­˜å…¥ç¼“å­˜ï¼ˆ1 å¹´ï¼‰

ç¬¬ 2 æ¬¡è®¿é—®ï¼ˆ1 å¹´å†…ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æµè§ˆå™¨  â”‚                    â”‚ æœåŠ¡å™¨  â”‚
â”‚  æ£€æŸ¥ï¼š  â”‚                    â”‚ (æ²¡å‚ä¸)â”‚
â”‚  - æ–‡ä»¶åä¸€æ ·ï¼Ÿâœ…             â”‚         â”‚
â”‚  - ç¼“å­˜è¿‡æœŸï¼ŸâŒ               â”‚         â”‚
â”‚  - ç›´æ¥ç”¨ç¼“å­˜ï¼              â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
ä»ç¼“å­˜è¯»å–ï¼ˆ0msï¼Œ0å­—èŠ‚æµé‡ï¼‰âš¡
Network é¢æ¿ï¼š200 (from disk cache)
```

#### å…³é”®å“åº”å¤´

```http
Cache-Control: public, max-age=31536000, immutable
Expires: Wed, 21 Oct 2025 07:28:00 GMT
```

**å‚æ•°è¯´æ˜**ï¼š
- `max-age=31536000`ï¼šç¼“å­˜ 1 å¹´ï¼ˆ31536000 ç§’ï¼‰
- `public`ï¼šå¯è¢«ä»»ä½•ç¼“å­˜ï¼ˆCDN + æµè§ˆå™¨ï¼‰
- `immutable`ï¼šå†…å®¹æ°¸ä¸æ”¹å˜ï¼Œå³ä½¿åˆ·æ–°ä¹Ÿä¸é‡æ–°éªŒè¯

---

### åå•†ç¼“å­˜ï¼ˆNegotiation Cacheï¼‰

#### å·¥ä½œæµç¨‹

```
ç¬¬ 1 æ¬¡è®¿é—®ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æµè§ˆå™¨  â”‚â”€â”€â”€ GET index.html â”€â”€>â”‚ æœåŠ¡å™¨  â”‚
â”‚         â”‚<â”€â”€ 200 + æ–‡ä»¶ â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚
â”‚         â”‚<â”€â”€ ETag: "abc123"   â”‚         â”‚
â”‚         â”‚<â”€â”€ Last-Modified: Mon, 01 Jan 2024
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
 å­˜å…¥ç¼“å­˜ï¼ˆè®°ä½ ETag å’Œ Last-Modifiedï¼‰

ç¬¬ 2 æ¬¡è®¿é—®ï¼ˆæ–‡ä»¶æœªæ”¹ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æµè§ˆå™¨  â”‚â”€â”€â”€ GET index.html â”€â”€>â”‚ æœåŠ¡å™¨  â”‚
â”‚         â”‚â”€â”€â”€ If-None-Match: "abc123"   â”‚
â”‚         â”‚â”€â”€â”€ If-Modified-Since: Mon... â”‚
â”‚         â”‚                    â”‚  æ£€æŸ¥ï¼š  â”‚
â”‚         â”‚                    â”‚  ETag ä¸€æ ·ï¼Ÿâ”‚
â”‚         â”‚                    â”‚  â†“       â”‚
â”‚         â”‚                    â”‚ æ²¡å˜ï¼   â”‚
â”‚         â”‚<â”€â”€ 304 Not Modifiedâ”‚         â”‚
â”‚         â”‚   (ä¸è¿”å›æ–‡ä»¶å†…å®¹)  â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼ˆ~50msï¼Œå‡ ç™¾å­—èŠ‚æµé‡ï¼‰
Network é¢æ¿ï¼š304 Not Modified

ç¬¬ 3 æ¬¡è®¿é—®ï¼ˆæ–‡ä»¶æ”¹äº†ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æµè§ˆå™¨  â”‚â”€â”€â”€ GET index.html â”€â”€>â”‚ æœåŠ¡å™¨  â”‚
â”‚         â”‚â”€â”€â”€ If-None-Match: "abc123"   â”‚
â”‚         â”‚                    â”‚  æ£€æŸ¥ï¼š  â”‚
â”‚         â”‚                    â”‚  ETag ä¸ä¸€æ ·ï¼â”‚
â”‚         â”‚                    â”‚  â†“       â”‚
â”‚         â”‚                    â”‚ æ–‡ä»¶å˜äº†ï¼â”‚
â”‚         â”‚<â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚
â”‚         â”‚<â”€â”€ ETag: "xyz789"  â”‚         â”‚
â”‚         â”‚<â”€â”€ æ–°æ–‡ä»¶å†…å®¹       â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
ä¸‹è½½æ–°æ–‡ä»¶å¹¶ç¼“å­˜
```

#### å…³é”®å“åº”å¤´

```http
// æœåŠ¡å™¨å“åº”
Cache-Control: no-cache
ETag: "5f7c8a9b"
Last-Modified: Mon, 01 Jan 2024 10:00:00 GMT

// æµè§ˆå™¨è¯·æ±‚
If-None-Match: "5f7c8a9b"
If-Modified-Since: Mon, 01 Jan 2024 10:00:00 GMT
```

---

### ç¼“å­˜ç­–ç•¥é€‰æ‹©

#### å¸¦ hash çš„æ–‡ä»¶ â†’ å¼ºç¼“å­˜ â­

```javascript
// æ–‡ä»¶ç¤ºä¾‹
vue-vendor-DSRHQCgV.js
index-Cy_phKJV.js

// ç¼“å­˜ç­–ç•¥
Cache-Control: public, max-age=31536000, immutable

// åŸå› 
âœ… æ–‡ä»¶ååŒ…å« hashï¼Œå†…å®¹æ”¹å˜ = æ–‡ä»¶åæ”¹å˜
âœ… åŒåæ–‡ä»¶å†…å®¹æ°¸è¿œä¸å˜
âœ… ä¸éœ€è¦é—®æœåŠ¡å™¨"å˜äº†å—ï¼Ÿ"
âœ… ç›´æ¥ç”¨ç¼“å­˜ï¼Œ0 å»¶è¿Ÿ
```

#### HTML å…¥å£æ–‡ä»¶ â†’ åå•†ç¼“å­˜ â­

```javascript
// æ–‡ä»¶ç¤ºä¾‹
index.html

// ç¼“å­˜ç­–ç•¥
Cache-Control: no-cache
ETag: "abc123"

// åŸå› 
âŒ æ–‡ä»¶åå›ºå®šï¼Œå†…å®¹ä¼šå˜ï¼ˆå¼•ç”¨çš„ JS æ–‡ä»¶åå˜äº†ï¼‰
âœ… æ¯æ¬¡éƒ½è¦é—®æœåŠ¡å™¨"å˜äº†å—ï¼Ÿ"
âœ… å¦‚æœæ²¡å˜ï¼Œè¿”å› 304ï¼Œç”¨ç¼“å­˜
âœ… å¦‚æœå˜äº†ï¼Œè¿”å› 200ï¼Œä¸‹è½½æ–°å†…å®¹
```

#### å›¾ç‰‡ç­‰èµ„æº â†’ åå•†ç¼“å­˜ + çŸ­æœŸå¼ºç¼“å­˜

```javascript
// æ–‡ä»¶ç¤ºä¾‹
logo.png, banner.jpg

// ç¼“å­˜ç­–ç•¥
Cache-Control: public, max-age=2592000  // 30 å¤©
ETag: on

// åŸå› 
âœ… ä¸å¸¸å˜ä½†ä¼šå˜
âœ… 30 å¤©å†…å¼ºç¼“å­˜ï¼ˆä¸è¯·æ±‚æœåŠ¡å™¨ï¼‰
âœ… 30 å¤©ååå•†ç¼“å­˜ï¼ˆè¯¢é—®æ˜¯å¦æ›´æ–°ï¼‰
```

---

### æ€§èƒ½å¯¹æ¯”

å‡è®¾æ–‡ä»¶ 100KBï¼Œç½‘ç»œå»¶è¿Ÿ 50msï¼š

| åœºæ™¯ | è¯·æ±‚æ¬¡æ•° | ä¼ è¾“å­—èŠ‚ | è€—æ—¶ | ä½“éªŒ |
|------|---------|---------|------|------|
| **æ— ç¼“å­˜** | æ¯æ¬¡ | 100KB | 500ms | âŒ æ…¢ |
| **åå•†ç¼“å­˜ï¼ˆ304ï¼‰** | æ¯æ¬¡ | ~500å­—èŠ‚ | 50ms | ğŸ†— è¿˜è¡Œ |
| **å¼ºç¼“å­˜** | 0 | 0å­—èŠ‚ | 0ms | âœ… æå¿« |

---

## ğŸŒ æœåŠ¡å™¨ç¼“å­˜é…ç½®

### Nginx é…ç½®

```nginx
server {
  location / {
    root /var/www/html;
    
    # 1. HTMLï¼šåå•†ç¼“å­˜ï¼ˆä½¿ç”¨ ETagï¼‰
    location ~* \.html$ {
      add_header Cache-Control "no-cache";  # å…è®¸ç¼“å­˜ä½†å¿…é¡»éªŒè¯
      etag on;                               # å¯ç”¨ ETag
      if_modified_since exact;               # ç²¾ç¡®åŒ¹é…ä¿®æ”¹æ—¶é—´
    }
    
    # 2. å¸¦ hash çš„ JS/CSSï¼šå¼ºç¼“å­˜ï¼ˆ1å¹´ï¼‰
    location ~* \-[0-9a-zA-Z]{8,}\.(js|css)$ {
      add_header Cache-Control "public, max-age=31536000, immutable";
      expires 1y;
    }
    
    # 3. å›¾ç‰‡ç­‰ï¼šåå•†ç¼“å­˜ + çŸ­æœŸå¼ºç¼“å­˜ï¼ˆ30å¤©ï¼‰
    location ~* \.(png|jpg|jpeg|gif|svg|ico|webp)$ {
      add_header Cache-Control "public, max-age=2592000";
      etag on;
    }
    
    # 4. å­—ä½“æ–‡ä»¶ï¼šå¼ºç¼“å­˜ï¼ˆ1å¹´ï¼‰
    location ~* \.(woff|woff2|ttf|eot)$ {
      add_header Cache-Control "public, max-age=31536000";
    }
  }
}
```

---

### Apache é…ç½®ï¼ˆ.htaccessï¼‰

```apache
# 1. HTML åå•†ç¼“å­˜
<FilesMatch "\.(html)$">
  Header set Cache-Control "no-cache"
  Header set ETag on
</FilesMatch>

# 2. å¸¦ hash çš„ JS/CSS å¼ºç¼“å­˜
<FilesMatch "\-[0-9a-zA-Z]{8,}\.(js|css)$">
  Header set Cache-Control "public, max-age=31536000, immutable"
  Header set Expires "access plus 1 year"
</FilesMatch>

# 3. å›¾ç‰‡åå•†ç¼“å­˜
<FilesMatch "\.(png|jpg|jpeg|gif|svg|webp)$">
  Header set Cache-Control "public, max-age=2592000"
  Header set ETag on
</FilesMatch>

# 4. å­—ä½“å¼ºç¼“å­˜
<FilesMatch "\.(woff|woff2|ttf|eot)$">
  Header set Cache-Control "public, max-age=31536000"
</FilesMatch>
```

---

### Node.js (Express) é…ç½®

```javascript
const express = require('express')
const app = express()

// 1. é™æ€èµ„æºé…ç½®ï¼ˆå¸¦ hash çš„æ–‡ä»¶ï¼‰
app.use('/assets', express.static('dist/assets', {
  maxAge: '1y',      // 1å¹´å¼ºç¼“å­˜
  immutable: true
}))

// 2. HTML é…ç½®ï¼ˆåå•†ç¼“å­˜ï¼‰
app.use(express.static('dist', {
  setHeaders: (res, path) => {
    if (path.endsWith('.html')) {
      res.setHeader('Cache-Control', 'no-cache')
      // Express é»˜è®¤å¯ç”¨ ETag
    }
  }
}))

app.listen(3000)
```

---

### Vercel/Netlify é…ç½®

```json
// vercel.json
{
  "headers": [
    {
      "source": "/(.*).html",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "no-cache"
        }
      ]
    },
    {
      "source": "/assets/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"
        }
      ]
    }
  ]
}
```

---

## ğŸ§ª å®é™…æµ‹è¯•æ–¹æ³•

### æµ‹è¯• 1ï¼šæŸ¥çœ‹æ‰“åŒ…ç»“æœ

```bash
# 1. æ‰“åŒ…é¡¹ç›®
npm run build

# 2. æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶
ls -lh dist/assets/js/

# è¾“å‡ºç¤ºä¾‹ï¼š
# -rw-r--r--  1 user  staff    85K  vue-vendor-DSRHQCgV.js
# -rw-r--r--  1 user  staff    70K  lodash-def456.js
# -rw-r--r--  1 user  staff    45K  index-ghi789.js
# -rw-r--r--  1 user  staff    25K  Home-jkl012.js

# 3. è§‚å¯Ÿæ–‡ä»¶åä¸­çš„ hash å€¼
```

---

### æµ‹è¯• 2ï¼šéªŒè¯å¼ºç¼“å­˜

```bash
# 1. å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨
npx serve dist

# 2. æ‰“å¼€æµè§ˆå™¨
# - è®¿é—® http://localhost:3000
# - æ‰“å¼€ DevTools â†’ Network é¢æ¿

# 3. é¦–æ¬¡è®¿é—®
# çŠ¶æ€ï¼š200 OKï¼ˆæ‰€æœ‰æ–‡ä»¶ï¼‰

# 4. åˆ·æ–°é¡µé¢ï¼ˆCtrl/Cmd + Rï¼‰
# vue-vendor.js: 200 (from disk cache) âœ…
# index.html: 200 OKï¼ˆé‡æ–°è¯·æ±‚ï¼‰

# 5. å¼ºåˆ¶åˆ·æ–°ï¼ˆCtrl/Cmd + Shift + Rï¼‰
# æ‰€æœ‰æ–‡ä»¶: 200 OKï¼ˆå¿½ç•¥ç¼“å­˜ï¼‰
```

---

### æµ‹è¯• 3ï¼šéªŒè¯åå•†ç¼“å­˜

```bash
# ä½¿ç”¨ curl æµ‹è¯•

# é¦–æ¬¡è¯·æ±‚
curl -I http://localhost:3000/index.html

# è¾“å‡ºï¼š
# HTTP/1.1 200 OK
# Cache-Control: no-cache
# ETag: "def456"
# Last-Modified: Mon, 11 Nov 2024 10:00:00 GMT
# Content-Length: 586

# ç¬¬äºŒæ¬¡è¯·æ±‚ï¼ˆå¸¦ If-None-Matchï¼‰
curl -I http://localhost:3000/index.html \
  -H "If-None-Match: def456"

# è¾“å‡ºï¼š
# HTTP/1.1 304 Not Modified  â† åå•†ç¼“å­˜ç”Ÿæ•ˆ
# ETag: "def456"
# Content-Length: 0  â† æ²¡æœ‰è¿”å›æ–‡ä»¶å†…å®¹
```

---

### æµ‹è¯• 4ï¼šæ¨¡æ‹Ÿä»£ç æ›´æ–°

```bash
# 1. è®°å½•å½“å‰ hash
ls dist/assets/js/

# è¾“å‡ºï¼š
# vue-vendor-DSRHQCgV.js
# index-Cy_phKJV.js

# 2. ä¿®æ”¹ä¸šåŠ¡ä»£ç 
# ç¼–è¾‘ src/views/Home.vue
echo "// test" >> src/views/Home.vue

# 3. é‡æ–°æ‰“åŒ…
npm run build

# 4. å†æ¬¡æŸ¥çœ‹æ–‡ä»¶
ls dist/assets/js/

# è¾“å‡ºï¼š
# vue-vendor-DSRHQCgV.js  â† hash ä¸å˜ï¼ˆVue æ²¡å˜ï¼‰
# index-XYZ12345.js       â† hash æ”¹å˜ï¼ˆä¸šåŠ¡ä»£ç å˜äº†ï¼‰

# 5. æµè§ˆå™¨å†æ¬¡è®¿é—®
# vue-vendor: ä½¿ç”¨ç¼“å­˜ âœ…
# index: ä¸‹è½½æ–°æ–‡ä»¶ âœ…
```

---

### æµ‹è¯• 5ï¼šæ‰“åŒ…åˆ†æ

```bash
# 1. è¿è¡Œæ‰“åŒ…åˆ†æ
npm run build -- --mode analyze

# æˆ–è€…åœ¨ package.json ä¸­æ·»åŠ è„šæœ¬
# "analyze": "vite build --mode analyze"

# 2. è‡ªåŠ¨æ‰“å¼€å¯è§†åŒ–é¡µé¢
# æŸ¥çœ‹ï¼š
# - æ¯ä¸ªåŒ…çš„ä½“ç§¯
# - å„ä¸ªä¾èµ–çš„å¤§å°
# - å æ¯”æƒ…å†µ
# - ä¼˜åŒ–å»ºè®®
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ä¸è¦è¿‡åº¦åˆ†åŒ…

```javascript
// âŒ é”™è¯¯ï¼šåŒ…å¤ªå¤šå¤ªå°
manualChunks: {
  'vue': ['vue'],               // 80KB
  'vue-router': ['vue-router'], // 20KB - å¤ªå°äº†ï¼
  'axios': ['axios'],           // 15KB - å¤ªå°äº†ï¼
  'dayjs': ['dayjs'],           // 10KB - å¤ªå°äº†ï¼
  // ... 100 ä¸ªå°åŒ…
}
```

**é—®é¢˜**ï¼š
- HTTP è¯·æ±‚è¿‡å¤šï¼ˆå»ºç«‹è¿æ¥çš„å¼€é”€ï¼‰
- æµè§ˆå™¨å¹¶å‘é™åˆ¶ï¼ˆåŒåŸŸåé€šå¸¸æœ€å¤š 6 ä¸ªå¹¶å‘ï¼‰
- å¢åŠ  HTTP å¤´å¼€é”€

**æ¨è**ï¼š
```javascript
// âœ… æ­£ç¡®ï¼šåˆç†åˆ†ç»„
manualChunks: {
  'vue-vendor': ['vue', 'vue-router', 'pinia'],  // 100KB
  'utils': ['axios', 'dayjs', 'lodash-es'],      // 95KB
  'ui-vendor': ['element-plus']                   // 200KB
}
```

---

### 2. åŒ…å¤§å°å»ºè®®

```
å•ä¸ªåŒ…å¤§å°ï¼š
âœ… ç†æƒ³ï¼š50KB - 250KB
ğŸ†— å¯æ¥å—ï¼š30KB - 500KB
âŒ é¿å…ï¼š< 20KBï¼ˆå¤ªå°ï¼ŒHTTP å¼€é”€å¤§ï¼‰
âŒ é¿å…ï¼š> 500KBï¼ˆå¤ªå¤§ï¼Œç¼“å­˜åˆ©ç”¨ç‡ä½ï¼‰

æ€»åŒ…æ•°é‡ï¼š
âœ… å°å‹é¡¹ç›®ï¼š3 - 5 ä¸ª
âœ… ä¸­å‹é¡¹ç›®ï¼š5 - 10 ä¸ª
âœ… å¤§å‹é¡¹ç›®ï¼š10 - 20 ä¸ª
âŒ é¿å…ï¼š> 30 ä¸ªï¼ˆè¯·æ±‚å¤ªå¤šï¼‰
```

---

### 3. ä¾èµ–åˆ†åŒ…åŸåˆ™

```javascript
// æŒ‰æ›´æ–°é¢‘ç‡åˆ†åŒ…

// âœ… å‡ ä¹ä¸æ›´æ–°ï¼ˆé•¿æœŸç¼“å­˜ï¼‰
'vue-vendor': ['vue', 'vue-router', 'pinia']

// âœ… å¶å°”æ›´æ–°ï¼ˆä¸­æœŸç¼“å­˜ï¼‰
'ui-vendor': ['element-plus']

// âœ… ç»å¸¸æ›´æ–°ï¼ˆçŸ­æœŸç¼“å­˜ï¼‰
// ä¸šåŠ¡ä»£ç è‡ªåŠ¨åˆ†åŒ…

// âœ… æŒ‰éœ€åŠ è½½ï¼ˆç”¨åˆ°æ‰åŠ è½½ï¼‰
'charts': ['echarts']  // åªåœ¨æŸäº›é¡µé¢ä½¿ç”¨
```

---

### 4. chunk å¤§å°è­¦å‘Š

```javascript
// vite.config.js
export default {
  build: {
    // è¶…è¿‡ 500KB ä¼šè­¦å‘Š
    chunkSizeWarningLimit: 500,
    
    rollupOptions: {
      output: {
        manualChunks: {
          // å¦‚æœæŸä¸ªåŒ…å¤ªå¤§ï¼Œè€ƒè™‘æ‹†åˆ†
          'ui-vendor': ['element-plus'],  // å¦‚æœ > 500KB
          // å¯ä»¥æ‹†åˆ†æˆï¼š
          // 'ui-base': ['element-plus/lib/button', ...],
          // 'ui-form': ['element-plus/lib/form', ...],
        }
      }
    }
  }
}
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å®Œæ•´çš„ Vite é…ç½®

```javascript
// vite.config.js
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { visualizer } from 'rollup-plugin-visualizer'
import viteCompression from 'vite-plugin-compression'

export default defineConfig(({ mode }) => {
  return {
    plugins: [
      vue(),
      
      // Gzip å‹ç¼©
      viteCompression({
        threshold: 10240, // 10KB ä»¥ä¸Šæ‰å‹ç¼©
        algorithm: 'gzip',
      }),
      
      // æ‰“åŒ…åˆ†æ
      mode === 'analyze' && visualizer({
        open: true,
        filename: 'dist/stats.html',
        gzipSize: true,
      }),
    ].filter(Boolean),
    
    build: {
      // ä»£ç å‹ç¼©
      minify: 'terser',
      terserOptions: {
        compress: {
          drop_console: true,
          drop_debugger: true,
        },
      },
      
      // CSS ä»£ç åˆ†å‰²
      cssCodeSplit: true,
      
      // åˆ†åŒ…ç­–ç•¥
      rollupOptions: {
        output: {
          // æ‰‹åŠ¨åˆ†åŒ…
          manualChunks: {
            'vue-vendor': ['vue', 'vue-router', 'pinia'],
            'ui-vendor': ['element-plus'],
            'utils': ['lodash-es', 'axios', 'dayjs'],
          },
          
          // æ–‡ä»¶å‘½åï¼ˆå¸¦ hashï¼‰
          chunkFileNames: 'assets/js/[name]-[hash].js',
          entryFileNames: 'assets/js/[name]-[hash].js',
          assetFileNames: 'assets/[ext]/[name]-[hash].[ext]',
        },
      },
      
      // chunk å¤§å°è­¦å‘Š
      chunkSizeWarningLimit: 500,
    },
    
    // ä¾èµ–é¢„æ„å»º
    optimizeDeps: {
      include: ['vue', 'vue-router', 'pinia'],
    },
  }
})
```

---

### 2. è·¯ç”±æ‡’åŠ è½½æœ€ä½³å®è·µ

```javascript
// router/index.js
import { createRouter, createWebHistory } from 'vue-router'

const routes = [
  {
    path: '/',
    name: 'Home',
    // âœ… é¦–é¡µï¼šé™æ€å¯¼å…¥ï¼ˆå¸¸ç”¨ï¼Œé¦–å±éœ€è¦ï¼‰
    component: () => import('@/views/Home.vue')
  },
  {
    path: '/about',
    name: 'About',
    // âœ… å…¶ä»–é¡µé¢ï¼šæ‡’åŠ è½½
    component: () => import('@/views/About.vue')
  },
  {
    path: '/dashboard',
    name: 'Dashboard',
    // âœ… å¤§å‹é¡µé¢ï¼šæ‡’åŠ è½½ + è‡ªå®šä¹‰ chunk åç§°
    component: () => import(
      /* webpackChunkName: "dashboard" */
      '@/views/Dashboard.vue'
    )
  }
]

const router = createRouter({
  history: createWebHistory(),
  routes,
  scrollBehavior(to, from, savedPosition) {
    return savedPosition || { top: 0 }
  }
})

// è·¯ç”±é¢„åŠ è½½ï¼ˆé¼ æ ‡æ‚¬åœæ—¶ï¼‰
router.beforeEach((to, from, next) => {
  // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ é¢„åŠ è½½é€»è¾‘
  next()
})

export default router
```

---

### 3. ç»„ä»¶æ‡’åŠ è½½

```vue
<script setup>
import { defineAsyncComponent } from 'vue'

// âœ… å¼‚æ­¥ç»„ä»¶ï¼ˆæ‡’åŠ è½½ï¼‰
const HeavyComponent = defineAsyncComponent(() =>
  import('@/components/HeavyComponent.vue')
)

// âœ… å¸¦åŠ è½½çŠ¶æ€çš„å¼‚æ­¥ç»„ä»¶
const AsyncComponent = defineAsyncComponent({
  loader: () => import('@/components/AsyncComponent.vue'),
  loadingComponent: LoadingSpinner,
  errorComponent: ErrorDisplay,
  delay: 200,
  timeout: 3000
})
</script>

<template>
  <div>
    <!-- åªåœ¨éœ€è¦æ—¶æ‰åŠ è½½ -->
    <HeavyComponent v-if="showHeavy" />
    
    <!-- å¸¦åŠ è½½çŠ¶æ€ -->
    <AsyncComponent />
  </div>
</template>
```

---

### 4. å®Œæ•´çš„ç¼“å­˜ç­–ç•¥

```javascript
// æ–‡ä»¶ç±»å‹ â†’ ç¼“å­˜ç­–ç•¥

HTML æ–‡ä»¶ (index.html)
â””â”€ Cache-Control: no-cache
â””â”€ ETag: on
â””â”€ åŸå› ï¼šéœ€è¦åŠæ—¶æ›´æ–°

å¸¦ hash çš„ JS/CSS (vue-vendor-abc123.js)
â””â”€ Cache-Control: max-age=31536000, immutable
â””â”€ åŸå› ï¼šå†…å®¹ä¸å˜ï¼Œæ°¸ä¹…ç¼“å­˜

å›¾ç‰‡ (logo.png)
â””â”€ Cache-Control: max-age=2592000  (30å¤©)
â””â”€ ETag: on
â””â”€ åŸå› ï¼šä¸å¸¸å˜ä½†ä¼šå˜

å­—ä½“ (font.woff2)
â””â”€ Cache-Control: max-age=31536000
â””â”€ åŸå› ï¼šå¾ˆå°‘æ›´æ–°
```

---

## â“ å¸¸è§é—®é¢˜

### Q1ï¼šä¸ºä»€ä¹ˆä¿®æ”¹ä»£ç åï¼Œæµè§ˆå™¨è¿˜æ˜¯æ—§ç‰ˆæœ¬ï¼Ÿ

**åŸå› **ï¼šå¯èƒ½æ˜¯ä»¥ä¸‹å‡ ç§æƒ…å†µ

1. **HTML æ–‡ä»¶è¢«å¼ºç¼“å­˜äº†**
```
è§£å†³ï¼šé…ç½® HTML ä¸º no-cache
Cache-Control: no-cache
```

2. **æµè§ˆå™¨ç¼“å­˜å¤ªå¼º**
```
è§£å†³ï¼šå¼ºåˆ¶åˆ·æ–°ï¼ˆCtrl + Shift + Rï¼‰
æˆ–è€…æ¸…ç©ºç¼“å­˜
```

3. **CDN ç¼“å­˜äº†æ—§ç‰ˆæœ¬**
```
è§£å†³ï¼šæ¸…é™¤ CDN ç¼“å­˜
æˆ–è€…ç­‰å¾… CDN ç¼“å­˜è¿‡æœŸ
```

---

### Q2ï¼šä¸ºä»€ä¹ˆæ‰“åŒ…åæ–‡ä»¶å¾ˆå¤šï¼Ÿ

**åŸå› **ï¼šä»£ç åˆ†å‰²åä¼šç”Ÿæˆå¤šä¸ªæ–‡ä»¶

```
è¿™æ˜¯æ­£å¸¸çš„ï¼å¥½å¤„ï¼š
âœ… æŒ‰éœ€åŠ è½½
âœ… å¹¶è¡Œä¸‹è½½
âœ… åˆ©ç”¨ç¼“å­˜

å¦‚æœè§‰å¾—å¤ªå¤šï¼š
1. å‡å°‘ manualChunks é…ç½®
2. åˆå¹¶ä¸€äº›å°åŒ…
3. è°ƒæ•´åˆ†åŒ…ç­–ç•¥
```

---

### Q3ï¼šhash æ–‡ä»¶åå¤ªé•¿æ€ä¹ˆåŠï¼Ÿ

```javascript
// å¯ä»¥è°ƒæ•´ hash é•¿åº¦
output: {
  chunkFileNames: 'assets/js/[name]-[hash:8].js',  // åªä¿ç•™ 8 ä½
  // é»˜è®¤æ˜¯å®Œæ•´ hash
}
```

---

### Q4ï¼šå¦‚ä½•åˆ†æå“ªäº›åŒ…å¤ªå¤§ï¼Ÿ

```bash
# 1. ä½¿ç”¨æ‰“åŒ…åˆ†æå·¥å…·
npm run build -- --mode analyze

# 2. æŸ¥çœ‹å¯è§†åŒ–æŠ¥å‘Š
# æ‰¾å‡ºå¤§äº 500KB çš„åŒ…

# 3. è€ƒè™‘æ‹†åˆ†æˆ–ä¼˜åŒ–
# - æŒ‰éœ€å¯¼å…¥
# - æ¢æ›´å°çš„åº“
# - ä½¿ç”¨ CDN
```

---

### Q5ï¼šåŠ¨æ€å¯¼å…¥å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

```javascript
// æ·»åŠ é”™è¯¯å¤„ç†
const AsyncComponent = defineAsyncComponent({
  loader: () => import('@/components/Heavy.vue'),
  
  // âœ… é”™è¯¯å¤„ç†
  onError(error, retry, fail, attempts) {
    if (attempts <= 3) {
      // é‡è¯• 3 æ¬¡
      retry()
    } else {
      // å¤±è´¥å¤„ç†
      console.error('ç»„ä»¶åŠ è½½å¤±è´¥', error)
      fail()
    }
  }
})
```

---

## ğŸ“ˆ ä¼˜åŒ–æ•ˆæœæ€»ç»“

### ä¼˜åŒ–å‰ vs ä¼˜åŒ–å

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| **é¦–å±åŠ è½½** | 245KB | 85KB | **65% â¬‡ï¸** |
| **é¦–å±æ—¶é—´** | 1.2s | 0.5s | **58% â¬‡ï¸** |
| **ç¼“å­˜å‘½ä¸­ç‡** | 0% | 69% | **69% â¬†ï¸** |
| **å¹¶è¡Œè¯·æ±‚** | 1 ä¸ª | 4-10 ä¸ª | **æ›´å¿«** |
| **ä»£ç æ›´æ–°å** | ä¸‹è½½ 245KB | ä¸‹è½½ 25KB | **90% â¬‡ï¸** |

---

### ç¼“å­˜æ•ˆæœï¼ˆä»¥ 3 ä¸ªæœˆä¸ºä¾‹ï¼‰

```
ç”¨æˆ·è®¿é—® 90 æ¬¡ï¼ŒæœŸé—´ä»£ç æ›´æ–° 60 æ¬¡

ä¸åˆ†åŒ…ï¼š
â””â”€ æ€»ä¸‹è½½ï¼š245KB Ã— 90 = 22 MB

åŸºç¡€åˆ†åŒ…ï¼š
â”œâ”€ é¦–æ¬¡ï¼š245KB
â”œâ”€ åç»­ï¼š45KB Ã— 89 = 4 MB
â””â”€ æ€»ä¸‹è½½ï¼š4.2 MB
â””â”€ èŠ‚çœï¼š17.8 MB (81%)

é«˜çº§åˆ†åŒ…ï¼š
â”œâ”€ é¦–æ¬¡ï¼š190KB
â”œâ”€ åç»­ï¼š25KB Ã— 89 = 2.2 MB
â””â”€ æ€»ä¸‹è½½ï¼š2.4 MB
â””â”€ èŠ‚çœï¼š19.6 MB (89%) ğŸš€
```

---

## ğŸ“ å­¦ä¹ æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **ä»£ç åˆ†å‰²** = å¤§åŒ…æ‹†å°åŒ…ï¼ŒæŒ‰éœ€åŠ è½½
2. **è·¯ç”±æ‡’åŠ è½½** = é¡µé¢ç‹¬ç«‹æ‰“åŒ…ï¼Œè®¿é—®æ—¶æ‰åŠ è½½
3. **æ‰‹åŠ¨åˆ†åŒ…** = æŠŠæ¡†æ¶å’Œä¸šåŠ¡ä»£ç åˆ†å¼€
4. **Hash å‘½å** = å†…å®¹å˜åŒ–æ‰æ”¹æ–‡ä»¶å
5. **å¼ºç¼“å­˜** = å¸¦ hash çš„æ–‡ä»¶ï¼Œæ°¸ä¹…ç¼“å­˜
6. **åå•†ç¼“å­˜** = HTML æ–‡ä»¶ï¼ŒåŠæ—¶æ›´æ–°

### å®æ–½æ­¥éª¤

```
æ­¥éª¤ 1ï¼šé…ç½®è·¯ç”±æ‡’åŠ è½½
â””â”€ æ‰€æœ‰è·¯ç”±éƒ½ç”¨ () => import()

æ­¥éª¤ 2ï¼šé…ç½®æ‰‹åŠ¨åˆ†åŒ…
â””â”€ manualChunks åˆ†ç¦»æ¡†æ¶ä»£ç 

æ­¥éª¤ 3ï¼šé…ç½® hash å‘½å
â””â”€ [name]-[hash].js

æ­¥éª¤ 4ï¼šé…ç½®æœåŠ¡å™¨ç¼“å­˜
â””â”€ Nginx/Apache è®¾ç½® Cache-Control

æ­¥éª¤ 5ï¼šæµ‹è¯•éªŒè¯
â””â”€ æ‰“åŒ…ã€éƒ¨ç½²ã€æµ‹è¯•ç¼“å­˜æ•ˆæœ

æ­¥éª¤ 6ï¼šæŒç»­ä¼˜åŒ–
â””â”€ åˆ†ææ‰“åŒ…ç»“æœï¼Œè°ƒæ•´åˆ†åŒ…ç­–ç•¥
```

---

## ğŸ”— ç›¸å…³èµ„æº

### å®˜æ–¹æ–‡æ¡£
- [Vite æ„å»ºä¼˜åŒ–](https://cn.vitejs.dev/guide/build.html)
- [Rollup ä»£ç åˆ†å‰²](https://rollupjs.org/guide/en/#code-splitting)
- [Vue Router æ‡’åŠ è½½](https://router.vuejs.org/zh/guide/advanced/lazy-loading.html)

### æ€§èƒ½ç›‘æ§å·¥å…·
- Chrome DevTools (Network / Performance)
- Lighthouse
- WebPageTest
- Bundle Analyzer

### å­¦ä¹ å»ºè®®
1. âœ… å…ˆç†è§£æ¦‚å¿µï¼ˆä¸ºä»€ä¹ˆéœ€è¦åˆ†åŒ…ï¼‰
2. âœ… å®è·µåŸºç¡€é…ç½®ï¼ˆè·¯ç”±æ‡’åŠ è½½ + åŸºç¡€åˆ†åŒ…ï¼‰
3. âœ… æµ‹è¯•æ•ˆæœï¼ˆæ‰“åŒ…åˆ†æ + ç¼“å­˜éªŒè¯ï¼‰
4. âœ… è¿›é˜¶ä¼˜åŒ–ï¼ˆé«˜çº§åˆ†åŒ… + ç»†ç²’åº¦æ§åˆ¶ï¼‰
5. âœ… æŒç»­ç›‘æ§ï¼ˆæ€§èƒ½æŒ‡æ ‡ + ç”¨æˆ·åé¦ˆï¼‰

---

**ç¥ä½ çš„åº”ç”¨åŠ è½½é£å¿«ï¼ğŸš€**

